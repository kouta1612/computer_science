# ふつうのLinuxプログラミング第2版

## リンク一覧

- [対象本](https://www.amazon.co.jp/dp/B075ST51Y5)
- [サポートサイト](https://i.loveruby.net/stdlinux2/)
- [Docker環境構築](https://www.isoroot.jp/blog/4714/)

## Dockerでubuntu環境構築

・Dockerfileをビルドしてイメージを作成

```terminal
docker build -t ubuntu .
```

・ubuntu環境を立ち上げる

bind mountしてあげるとローカル作業ディレクトリとDocker環境で同期されるので便利
コンテナから外れると自動的に削除してくれるようにした（rmオプション）

```terminal
docker run --rm -it --volume $(pwd):/app ubuntu
```

## ビルドした環境と違う環境で実行ファイルを実行しようとするとエラーになるので注意

例えばdocker内のubuntu上でビルドして生成された実行ファイルをmac上で実行しようとするとformat errorになる

## 2.1 Linuxを理解するとは

- Linux世界とは
  - Linuxカーネルの作り出す世界
- Linuxカーネルとは
  - ファイルシステム・プロセス・ストリームを作り出すもの
  - システムコールを利用する

## 2.2 ライブラリ

- API（Application Programming Interface）
  - 何かを使ってプログラミングする時のインターフェース
    - C言語のライブラリのAPIは関数やマクロ
    - カーネルのAPIはシステムコール
    - 場合によっては設定ファイルやLinuxコマンドなどもAPIに入る

## 3.3 ストリーム

- ストリーム
  - バイト列が流れる通り道
  - バイト列が流れとして考えられるものであればどんなものでもストリームにつなぐ事ができる
  - 使用例
    - ファイルへのアクセス
      - 事前にファイルにつながるストリームを作成するようシステムコールを使ってカーネルに依頼する
      - ストリームを操作してファイルにアクセス
    - SSDへのアクセス
    - HDDへのアクセス
    - キーボードへのアクセス
  - ストリームの両端がプロセスの場合
    - プロセス間通信と呼ばれる
      - ローカルに閉じている場合
        - パイプと呼ばれる
          - grepやlessを使用するときに使われる
      - ネットワーク間の通信の場合
        - ネットワーク通信と呼ばれる

## 4.1 ユーザとグループ

- アクセス権限
  - あるゆる絵権限をもつユーザ
    - スーパーユーザ
    - 通常はrootという名前

## 4.2 シェルと端末

- コマンドライン
  - シェルと端末という２つの要素から構成される
  - シェル
    - ユーザからの命令を解釈して実行するプログラム
    - ストリームからコマンドを読み取って実行するプログラム
    - sh,bash,csh,zsh,ash等がある
    - ストリームが端末に繋がっている場合は、シェルはコマンドラインプロンプトを出力する

## 5.2 ファイルディスクリプタ

- ファイルディスクリプタ
  - プログラムからストリームを扱う際に使う
  - プログラムから見たら単なる整数値
  - 色々な理由でストリームをプロセスに直接見せるわけにはいかない
    - カーネルが持つストリームを番号と紐付けて、プロセスには番号でストリームを指定させる

## 5.3 標準入力、標準出力、標準エラー出力

- 標準入力
  - プログラムのデフォルト入力元
- 標準出力
  - プログラムのデフォルト出力先

## 5.5 ストリームに関わるシステムコール

- ストリームを閉じる
  - ファイルディスクリプタに紐づくストリームを指定して閉じる処理を行う必要がある
    - プロセスが同時に使用できるストリームの数には制限があるから
    - ストリームを閉じるまで相手まで終了できなくなるから
  - 閉じる処理を多少忘れたとしても、問題にならないことも多い
    - プロセスが終了した時点でそのプロセスが使用していたストリームをカーネルが破棄してくれるから
